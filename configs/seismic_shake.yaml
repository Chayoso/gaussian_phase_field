# Seismic Shake Demo
# Stanford bunny settles on ground, then horizontal oscillation causes crack propagation.
# ~38 frames: free-fall + settlement (gravity=-300)
# frame 45+: seismic stress nucleates cracks + branching
# 150 frames @ 30 FPS = 5s video | 5.6 seismic cycles in physics time

simulation:
  name: "seismic_shake"
  description: "Bunny on ground — horizontal seismic shaking causes crack propagation"
  mode: "deformation"
  output_dir: "output/seismic"
  save_frames: true
  save_checkpoint: false

mesh:
  path: "assets/meshes/bunny.obj"
  auto_generate_if_missing: true
  test_mesh_type: "sphere"
  test_mesh_radius: 0.4

particles:
  target_count: 300000
  surface_ratio: 0.5
  use_poisson_sampling: false
  poisson_depth: 8
  normalize_to_unit_cube: true

mpm:
  num_grids: 128
  dt: 1.0e-4
  gravity: [0.0, 0.0, -300.0]    # Fast settlement (same as gravity_drop)
  clip_bound: 0.05
  damping: 0.9998                 # Slightly higher than gravity_drop — preserve oscillation
  particle_chunk: 8192

material:
  preset: null
  constitutive_model: "corotated_phase_field"
  center: [0.5, 0.5, 0.5]
  size: [0.8, 0.8, 0.8]
  density: 1200.0
  youngs_modulus: 5.0e6
  poissons_ratio: 0.25
  Gc: 80000.0                     # Lower than gravity_drop (120000) — more brittle under cyclic loading
  l0: 0.025
  degradation_exponent: 3.0

phase_field:
  warmup_frames: 20               # With scale=0.33, bunny hits ground at ~frame 16
  dC_max: 0.25
  crack_tip_speed: 8.0
  crack_width: 0.004
  max_total_cracks: 48
  crack_aniso_ratio: 200.0
  branch_angle: 25.0
  branch_min_length: 4
  branch_probability: 0.50
  max_branches_per_path: 3
  nucleation_fraction: 0.30       # Seismic → distributed stress → multi-site nucleation
  max_nucleation_per_frame: 2     # Slightly faster nucleation than impact scenario
  nucleation_min_spacing: 10
  fragmentation_enabled: true
  fragment_damage_threshold: 0.5
  min_fragment_particles: 50

seismic:
  enabled: true
  amplitude: 1500.0               # ~0.5g (gravity=-300=1g); tuned for scale=0.33 bunny
  frequency: 20.0                 # 20 Hz → 4.5 cycles in 0.225s physics time
  direction: [1.0, 0.2, 0.0]     # Primarily X, slight Y — asymmetric for natural crack paths
  ramp_time: 0.015                # Gradual ramp over ~10 frames before full amplitude

pre_notch:
  enabled: false

external_force:
  enabled: false

ground_plane:
  enabled: true
  point: [0.5, 0.5, 0.05]
  normal: [0.0, 0.0, 1.0]
  surface_type: "slip"            # Horizontal sliding allowed; shear stress from inertia difference
  friction: 0.8

loading:
  type: "seismic"
  object_scale: 0.33              # Rescale bunny (same as gravity_drop) — prevents wall collision
  object_center: [0.5, 0.5, 0.30]  # Place near ground; bunny bottom ~z=0.13, ground at z=0.05

coordinate_mapping:
  world_center: [0.5, 0.5, 0.5]
  world_scale: 1.0

damage_projection:
  method: "knn_weighted"
  k_neighbors: 8
  influence_radius: 0.05
  damage_threshold: 0.01
  use_faiss: true

gaussian_splatting:
  sh_degree: 3
  crack_color: [0.6, 0.08, 0.08]
  opacity_mode: "smooth"
  color_mode: "overlay"
  scale_mode: null
  damage_threshold: 0.45
  sharp_k: 50.0
  edge_width: 0.02
  crack_opacity_reduction: 0.70
  crack_max_opening: 0.010
  crack_gap_fraction: 0.35
  crack_edge_darken: 0.75
  crack_red_accent: 0.10

rendering:
  image_width: 1920
  image_height: 1920
  background_color: [1.0, 1.0, 1.0]
  camera:
    distance: 0.85
    elevation: 20.0
    azimuth: 30.0
    fov: 50.0
    target: [0.5, 0.5, 0.25]     # Lower than gravity_drop — bunny rests on ground
  total_frames: 150               # 5s @ 30 FPS: ~38 settle + ~107 seismic cracking
  fps: 30
  physics_substeps: 15

output:
  video_path: "output/seismic/seismic_shake.mp4"
  frame_dir: "output/seismic/frames"
  statistics_log: "output/seismic/statistics.csv"
  checkpoint_dir: "output/seismic/checkpoints"
  log_interval: 50
  verbose: true

device:
  type: "cuda"
  gpu_id: 0
